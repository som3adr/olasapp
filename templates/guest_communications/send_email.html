{% extends "base.html" %}

{% block title %}Send Email - HostelFlow{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-envelope me-2"></i>Send Email</h2>
                <a href="{{ url_for('guest_communications.index') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Communications
                </a>
            </div>
        </div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-paper-plane me-2"></i>Compose Email</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="recipient_type" class="form-label">Recipients *</label>
                            <select class="form-select" id="recipient_type" name="recipient_type" required>
                                <option value="">Select recipients...</option>
                                <option value="all">All Guests with Email ({{ guests|length }})</option>
                                <option value="active">Active Guests Only</option>
                                <optgroup label="Individual Guests">
                                    {% for guest in guests %}
                                    <option value="guest_{{ guest.id }}">{{ guest.name }} ({{ guest.email }})</option>
                                    {% endfor %}
                                </optgroup>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="subject" class="form-label">Subject *</label>
                            <input type="text" class="form-control" id="subject" name="subject" required
                                   placeholder="Enter email subject">
                        </div>

                        <div class="mb-3">
                            <label for="message" class="form-label">Message *</label>
                            <textarea class="form-control" id="message" name="message" rows="8" required
                                      placeholder="Enter your message here..."></textarea>
                            <div class="form-text">
                                You can use placeholders: {guest_name}, {room_number}, {bed_number}, {check_in_date}
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6><i class="fas fa-info-circle me-2"></i>Quick Templates</h6>
                                    <div class="btn-group-vertical w-100" role="group">
                                        <button type="button" class="btn btn-outline-primary btn-sm mb-1" 
                                                onclick="fillTemplate('welcome')">
                                            Welcome Message
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm mb-1" 
                                                onclick="fillTemplate('checkout')">
                                            Check-out Reminder
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm mb-1" 
                                                onclick="fillTemplate('wifi')">
                                            WiFi Information
                                        </button>
                                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                                onclick="fillTemplate('payment')">
                                            Payment Reminder
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-secondary" onclick="previewEmail()">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane me-1"></i>Send Email
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div class="modal fade" id="previewModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-eye me-2"></i>Email Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong>Subject:</strong>
                    <div id="preview-subject" class="border p-2 bg-light"></div>
                </div>
                <div class="mb-3">
                    <strong>Message:</strong>
                    <div id="preview-message" class="border p-3 bg-light" style="white-space: pre-line;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
const templates = {
    welcome: {
        subject: 'Welcome to Our Hostel!',
        message: 'Dear {guest_name},\n\nWelcome to our hostel! We hope you have a wonderful stay.\n\nYour room details:\n- Room: {room_number}\n- Bed: {bed_number}\n- Check-in: {check_in_date}\n\nIf you need anything, please don\'t hesitate to contact us at the front desk.\n\nBest regards,\nHostel Management Team'
    },
    checkout: {
        subject: 'Check-out Reminder',
        message: 'Dear {guest_name},\n\nThis is a friendly reminder that your check-out is scheduled for tomorrow at 11:00 AM.\n\nPlease ensure:\n- All belongings are packed\n- Room key is returned to front desk\n- Any outstanding payments are settled\n\nThank you for staying with us!\n\nBest regards,\nHostel Management Team'
    },
    wifi: {
        subject: 'WiFi Access Information',
        message: 'Dear {guest_name},\n\nHere are your WiFi access details:\n\nNetwork Name: HostelWiFi\nPassword: Welcome123\n\nFor any connectivity issues, please contact the front desk.\n\nEnjoy your stay!\n\nBest regards,\nHostel Management Team'
    },
    payment: {
        subject: 'Payment Reminder',
        message: 'Dear {guest_name},\n\nThis is a friendly reminder that your payment is due.\n\nPlease visit the front desk at your earliest convenience to complete the payment.\n\nIf you have any questions about your bill, please don\'t hesitate to ask our staff.\n\nThank you,\nHostel Management Team'
    }
};

function fillTemplate(templateName) {
    const template = templates[templateName];
    if (template) {
        document.getElementById('subject').value = template.subject;
        document.getElementById('message').value = template.message;
    }
}

function previewEmail() {
    const subject = document.getElementById('subject').value;
    const message = document.getElementById('message').value;
    
    document.getElementById('preview-subject').textContent = subject;
    document.getElementById('preview-message').textContent = message;
    
    const modal = new bootstrap.Modal(document.getElementById('previewModal'));
    modal.show();
}
</script>
{% endblock %}

