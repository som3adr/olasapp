{% extends "base.html" %}

{% block page_title %}Financial Reports{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line me-2"></i>Financial Reports Dashboard
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-4">
                    <!-- Profit & Loss -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-primary h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-chart-pie fa-3x text-primary"></i>
                                </div>
                                <h5>Profit & Loss Statement</h5>
                                <p class="text-muted">Comprehensive income and expense analysis with profit margins and key metrics.</p>
                                <a href="{{ url_for('financial_reports.profit_loss') }}" class="btn btn-primary">
                                    <i class="fas fa-eye me-2"></i>View Report
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Analysis -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-success h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-dollar-sign fa-3x text-success"></i>
                                </div>
                                <h5>Revenue Analysis</h5>
                                <p class="text-muted">Revenue trends, source breakdown, and top-performing guests analysis.</p>
                                <a href="{{ url_for('financial_reports.revenue_analysis') }}" class="btn btn-success">
                                    <i class="fas fa-eye me-2"></i>View Report
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Expense Analysis -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-warning h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-receipt fa-3x text-warning"></i>
                                </div>
                                <h5>Expense Analysis</h5>
                                <p class="text-muted">Cost breakdown by category, trends, and expense optimization insights.</p>
                                <a href="{{ url_for('financial_reports.expense_analysis') }}" class="btn btn-warning">
                                    <i class="fas fa-eye me-2"></i>View Report
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Cash Flow -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-info h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-exchange-alt fa-3x text-info"></i>
                                </div>
                                <h5>Cash Flow Analysis</h5>
                                <p class="text-muted">Daily cash flow tracking, running balances, and liquidity analysis.</p>
                                <a href="{{ url_for('financial_reports.cash_flow') }}" class="btn btn-info">
                                    <i class="fas fa-eye me-2"></i>View Report
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Guest Revenue -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-secondary h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-users fa-3x text-secondary"></i>
                                </div>
                                <h5>Guest Analytics</h5>
                                <p class="text-muted">Guest lifetime value, payment patterns, and customer insights.</p>
                                <a href="{{ url_for('reports.guests_overview') }}" class="btn btn-secondary">
                                    <i class="fas fa-eye me-2"></i>View Report
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Occupancy Reports -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card border-dark h-100">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="fas fa-bed fa-3x text-dark"></i>
                                </div>
                                <h5>Occupancy Reports</h5>
                                <p class="text-muted">Room utilization, ADR, RevPAR, and occupancy trend analysis.</p>
                                <a href="{{ url_for('reports.index') }}" class="btn btn-dark">
                                    <i class="fas fa-eye me-2"></i>View Reports
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tachometer-alt me-2"></i>Quick Financial Overview
                </h5>
            </div>
            <div class="card-body">
                <div id="monthlyComparisonChart" style="height: 300px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
// Load monthly comparison chart
fetch('{{ url_for("financial_reports.monthly_comparison_api") }}')
    .then(response => response.json())
    .then(data => {
        const ctx = document.createElement('canvas');
        document.getElementById('monthlyComparisonChart').appendChild(ctx);
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: data.map(d => d.month),
                datasets: [{
                    label: 'Revenue',
                    data: data.map(d => d.revenue),
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.1
                }, {
                    label: 'Expenses',
                    data: data.map(d => d.expenses),
                    borderColor: 'rgb(255, 99, 132)',
                    backgroundColor: 'rgba(255, 99, 132, 0.1)',
                    tension: 0.1
                }, {
                    label: 'Profit',
                    data: data.map(d => d.profit),
                    borderColor: 'rgb(54, 162, 235)',
                    backgroundColor: 'rgba(54, 162, 235, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Monthly Financial Comparison (Last 12 Months)'
                    }
                }
            }
        });
    })
    .catch(error => {
        document.getElementById('monthlyComparisonChart').innerHTML = 
            '<div class="text-center text-muted py-4"><p>Unable to load chart data</p></div>';
    });
</script>
{% endblock %}
